<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="group.oneonetwo.hotelintelligencesystem.modules.room.dao.RoomMapper">
    <resultMap id="roomVO" type="group.oneonetwo.hotelintelligencesystem.modules.room.model.vo.RoomVO">
    </resultMap>
    <resultMap id="roomMap" type="group.oneonetwo.hotelintelligencesystem.modules.room.model.po.RoomPO">
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="type" column="type"/>
        <result property="status" column="status"/>
        <result property="floor" column="floor"/>
        <result property="direction" column="direction"/>
        <result property="hotelId" column="hotel_id"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
        <result property="isDeleted" column="is_deleted"/>
        <result property="orderId" column="order_id"/>

    </resultMap>
    <sql id="baseListSql">
        SELECT r.* , r_t.`name` as 'roomTypeName'
        FROM room r LEFT JOIN room_type r_t on r.type=r_t.id
    </sql>

    <sql id="basetypelist">
        SELECT r_t.`name` as 'roomTypeName'
        FROM room r LEFT JOIN
        room_type r_t on r.type=r_t.id

    </sql>

    <sql id="baselist">
        SELECT * FROM room r
                          LEFT JOIN room_type  r_t
                                    on r.type=r_t.id
                          left JOIN bed_type b
                                    on r.type=b.id;

    </sql>
    <select id="getRoomTypeList" resultType="group.oneonetwo.hotelintelligencesystem.modules.room.model.vo.RoomVO">
        <include refid="basetypelist"/>
            <where>
                AND r.`status`='0'
                <if test="vo.id!=null and vo.id!=''">
                    AND  r.id=#{vo.id}
                </if>
                    group by r_t.`name`
            </where>
    </select>



    <select id="getDetail" resultType="group.oneonetwo.hotelintelligencesystem.modules.room.model.vo.RoomVO">
        <include refid="baselist"/>
        <where>
            <if test="id!=null and id!=''">
                AND  r.id=#{id}
            </if>
        </where>

    </select>

    <select id="getAllList" resultType="group.oneonetwo.hotelintelligencesystem.modules.room.model.vo.RoomVO">
        <include refid="baseListSql"/>
            <where>
                <if test="vo.floor!=null and vo.floor!=''">
                    AND r.floor=#{vo.floor}
                </if>
                <if test="vo.name!=null and vo.name!=''">
                    and r.name=#{vo.name}
                </if>
                <if test="vo.roomTypeName!=null and vo.roomTypeName!=''">
                    and r_t.`name` like concat('%',#{vo.roomTypeName},'%')
                </if>
                <if test="vo.hotelId!=null and vo.hotelId!=''">
                    and r.hotel_id=#{vo.hotelId}
                </if>
                <if test="vo.id!=null and vo.id!=''">
                    and r.id=#{vo.id}
                </if>
            </where>
    </select>

    <update id="unlockRoom">
        update room
        set status = 0 and order_id = null
        where id = #{id}
    </update>

</mapper>
